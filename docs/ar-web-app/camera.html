<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>ARte</title>

        <script src="./js/aframe-master.min.js"></script>
        <script src="./js/aframe-ar-nft.js"></script>
        <script src="./js/jquery-3.5.1.min.js"></script>

        <style>
            .arjs-loader {
                height: 100%;
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
                background-color: rgba(0, 0, 0, 0.8);
                z-index: 9999;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .arjs-loader div {
                text-align: center;
                font-size: 1.25em;
                color: white;
            }
            #artwork .title {
                color: #FFF;
                text-shadow: 1px 1px 0 0 #ABABAB;
                position: fixed;
                bottom: 25vw;
                left: 2vw;
                font-family: Helvetica;
                font-size: 1.5rem;
            }
            body {
                margin: 0px;
                overflow: hidden;
                font-family: Helvetica;
            }
            .commands {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100vw;
                height: 22vw;
                background-color: rgba(255, 255, 255, 0.8);
                z-index: 1000;
                text-align: center;
            }
            .commands div.button {
                width: calc( 16vw - 2px );
                height: calc( 16vw - 2px );
                border-radius: 50%;
                margin: 3vw 3.33vw 3vw 0;
                border: 1px solid #ABABAB;
                float: left;
                transition: all 0.2s ease-in-out;
            }
            .commands div.button:first-of-type {
                margin: 3vw 3.33vw 3vw 3.33vw;
            }
            .commands div.button.pressed {
                background-color: #B7B7B7;
            }
            .commands div.button img {
                margin: calc( 8vw - 1px ) calc( 4vw - 1px ) 0 calc( 4vw - 1px );
                width: 8vw;
                transform: translateY(-50%);
            }
            header {
                background-color: rgba(255, 255, 255, 0.8);
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 70px;
                z-index: 1000;
                text-align: center;
            }
            header a img {
                height: 50px;
                margin: 10px 0;
            }
            #info {
                color: #FFF;
                text-shadow: 1px 1px 0 0 #ABABAB;
                position: fixed;
                top: 80px;
                width: 100vw;
                text-align: center;
                font-family: Helvetica;
                font-size: 1rem;
            }
        </style>
    </head>
    <body>
        <header>
            <a href="">
                <img src="./img/logo.png" alt="logo">
            </a>
        </header>

        <!-- Minimal loader shown until image descriptors are loaded -->
        <div class="arjs-loader">
            <div>Loading, please wait...</div>
        </div>

        <!-- Artwork description -->
        <div id="artwork" hidden>
            <div class="title">Discobolus</div>
        </div>

        <div id="info" hidden>
            <p>Artwork detected</p>
        </div>

        <div class="commands">
           <div class="button">
                <img src="./img/icons/animation.svg" alt="Animation">
            </div>
            <div class="button">
                <img src="./img/icons/contextualization.svg" alt="Contextualization">
            </div>
            <div class="button">
                <img src="./img/icons/camera.svg" alt="Camera">
            </div>
            <div class="button">
                <img src="./img/icons/rebuilding.svg" alt="Rebuilding">
            </div>
            <div class="button" id="play">
                <img src="./img/icons/storytelling.svg" alt="Storytelling">
            </div>
        </div>

        <a-scene
            vr-mode-ui='enabled: false;'
            renderer="logarithmicDepthBuffer: true;"
            embedded arjs='trackingMethod: best; sourceType: webcam; debugUIEnabled: false;'>

            <!-- use rawgithack to retrieve the correct url for nft marker (see 'pinball' below) -->
            <a-nft type='nft' url='https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/trex-image/trex' smooth='true' smoothCount='10' smoothTolerance='0.01' smoothThreshold='5'>
                <a-entity
                    gltf-model='./models/scene.gltf'
                    scale="0.15 0.15 0.15"
                    position="100 0 50"
                    rotation="-90 0 0"
                    >
                </a-entity>
            </a-nft>
            <a-entity camera></a-entity>
        </a-scene>

        <script>
            var message = {
                deviceID: '',
                datetime: '',
                feature: '',
                usageTime: '',
                artworkID: ''
            }

            // Status: 0 -> Stopped, 1 -> Paused, 2 -> Playing
            var storytellingStatus = 0;

            // Features
            var activeFeature = '';

            // Recognized artwork?
            var artworkRecognized = 0;

            $(document).ready(function() {

                // Initialize audio for storytelling
                var audioElement = document.createElement('audio');
                audioElement.setAttribute('src', 'http://www.soundjay.com/misc/sounds/bell-ringing-01.mp3');
                audioElement.addEventListener('ended', function() {
                    this.play();
                }, false);

                audioElement.addEventListener("canplay",function(){
                    $("#length").text("Duration:" + audioElement.duration + " seconds");
                    $("#source").text("Source:" + audioElement.src);
                    $("#status").text("Status: Ready to play").css("color","green");
                });

                audioElement.addEventListener("timeupdate",function(){
                    $("#currentTime").text("Current second:" + audioElement.currentTime);
                });

                $('#play').click(function() {
                    if( storytellingStatus == 2 ) {
                        audioElement.pause();
                        storytellingStatus = 1;
                    } else if( storytellingStatus < 2 && artworkRecognized == 1 ) {
                        audioElement.play();
                        storytellingStatus = 2;
                    }
                });

                $('#restart').click(function() {
                    audioElement.currentTime = 0;
                });

                // Changing style to buttons when pressed
                $('.commands .button').click(function() {
                    var pressed = $(this).hasClass('pressed');
                    if( pressed ) {
                        $(this).removeClass('pressed');
                    } else {
                        $('.commands .button').removeClass('pressed');
                        $(this).addClass('pressed');
                    }
                });


                // This event is triggered when a new marker is recognized
                // We should show artwork's informations
                $('body').on( "markerFound", function() {
                    artworkRecognized = 1;
                    $('#artwork').toggle();
                    $('#info').show().delay(3000).fadeOut();
                });

                // This event is triggered when a new marker is no more recognized
                $('body').on( "markerLost", function() {
                    artworkRecognized = 0;
                   $('#artwork').toggle();
                });


            });

            // Selector for functions
            function toggleFunction() {

            }
        </script>
    </body>
</html>
